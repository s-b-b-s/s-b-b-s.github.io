{"componentChunkName":"component---src-templates-blog-template-js","path":"/4-aws-3/","result":{"data":{"cur":{"id":"d9236e0d-b11e-5684-a446-db016218491a","html":"<h2 id=\"-소개\" style=\"position:relative;\"><a href=\"#-%EC%86%8C%EA%B0%9C\" aria-label=\" 소개 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>👋 소개</h2>\n<p>awscli를 Roles Anywhere를 통해서 접속 해보자🙌</p>\n<ul>\n<li>1 RootCA 인증서 만들기 (CA Bundle 인증서) - <strong>1편</strong></li>\n<li>2 SSL 인증서 만들기 (RootCA로 서명한 aws접속용 인증서) - <strong>1편</strong></li>\n<li>3 CA Bundle 등록(trust-anchor) - <strong>2편</strong></li>\n<li>4 role 생성 - <strong>2편</strong></li>\n<li>5 profile 생성 - <strong>2편</strong></li>\n<li>6 aws_credential_helper로 credentials 생성 - <strong>2편</strong></li>\n<li>7 aws cli 설치 및 명령어 사용 해보기 - <strong>2편</strong></li>\n<li>8 EC2에 SSM Agent 설치 - <strong>3편</strong></li>\n<li>9 PC에 SSM plugin 설치후 aws cli로 EC2접속 - <strong>3편</strong></li>\n</ul>\n<hr>\n<h3 id=\"️-8-ec2에-ssm-agent-설치\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-8-ec2%EC%97%90-ssm-agent-%EC%84%A4%EC%B9%98\" aria-label=\"️ 8 ec2에 ssm agent 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>⌨️ 8. EC2에 SSM Agent 설치</h3>\n<p><a href=\"https://docs.aws.amazon.com/ko_kr/systems-manager/latest/userguide/agent-install-al.html\">https://docs.aws.amazon.com/ko_kr/systems-manager/latest/userguide/agent-install-al.html</a> <br></p>\n<blockquote>\n<p>EC2를 접속하여 아키텍처에 따른 Agent 설치 <br></p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 설치</span>\n<span class=\"token function\">sudo</span> yum <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> https://s3.amazonaws.com/ec2-downloads-windows/SSMAgent/latest/linux_amd64/amazon-ssm-agent.rpm\n\n<span class=\"token comment\"># 설치 확인</span>\n<span class=\"token function\">sudo</span> systemctl status amazon-ssm-agent</code></pre></div>\n<hr>\n<h3 id=\"️-9-pc에-ssm-plugin-설치후-aws-cli로-ec2접속\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-9-pc%EC%97%90-ssm-plugin-%EC%84%A4%EC%B9%98%ED%9B%84-aws-cli%EB%A1%9C-ec2%EC%A0%91%EC%86%8D\" aria-label=\"️ 9 pc에 ssm plugin 설치후 aws cli로 ec2접속 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>⌨️ 9. PC에 SSM plugin 설치후 aws cli로 EC2접속</h3>\n<p><a href=\"https://docs.aws.amazon.com/ko_kr/systems-manager/latest/userguide/session-manager-working-with-install-plugin.html\">https://docs.aws.amazon.com/ko_kr/systems-manager/latest/userguide/session-manager-working-with-install-plugin.html</a>  <br></p>\n<blockquote>\n<p>본인 OS에 맞는 플로그인 다운로드 및 설치 <br></p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 다운로드</span>\n<span class=\"token function\">curl</span> <span class=\"token string\">\"https://s3.amazonaws.com/session-manager-downloads/plugin/latest/mac/sessionmanager-bundle.zip\"</span> <span class=\"token parameter variable\">-o</span> <span class=\"token string\">\"sessionmanager-bundle.zip\"</span>\n\n<span class=\"token comment\"># 압축해제 </span>\n<span class=\"token function\">unzip</span> sessionmanager-bundle.zip\n\n<span class=\"token comment\"># 설치 명령</span>\n<span class=\"token function\">sudo</span> ./sessionmanager-bundle/install <span class=\"token parameter variable\">-i</span> /usr/local/sessionmanagerplugin <span class=\"token parameter variable\">-b</span> /usr/local/bin/session-manager-plugin</code></pre></div>\n<blockquote>\n<p>AWS CLI로 SSM 으로 EC2 접속 해보기<br></p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># InstanceId 로 grep 을 함</span>\n<span class=\"token operator\">></span> aws ec2 describe-instances <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> InstanceId\n<span class=\"token comment\"># 이런값이 나옴 \"InstanceId\": \"i-0504b7490773b25be\"</span>\n\n<span class=\"token comment\"># 위에 나온 ID로 접속하면 EC2 접근됨</span>\n<span class=\"token operator\">></span> aws ssm start-session <span class=\"token parameter variable\">--target</span> i-0504b7490773b25be</code></pre></div>\n<h3 id=\"참고사이트\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0%EC%82%AC%EC%9D%B4%ED%8A%B8\" aria-label=\"참고사이트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고사이트</h3>\n<blockquote>\n<p><a href=\"https://docs.aws.amazon.com/ko_kr/systems-manager/latest/userguide/agent-install-al.html\">https://docs.aws.amazon.com/ko_kr/systems-manager/latest/userguide/agent-install-al.html</a><br>\n<a href=\"https://docs.aws.amazon.com/ko_kr/systems-manager/latest/userguide/session-manager-working-with-install-plugin.html\">https://docs.aws.amazon.com/ko_kr/systems-manager/latest/userguide/session-manager-working-with-install-plugin.html</a></p>\n</blockquote>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#-%EC%86%8C%EA%B0%9C\">👋 소개</a></p>\n<ul>\n<li><a href=\"#%EF%B8%8F-8-ec2%EC%97%90-ssm-agent-%EC%84%A4%EC%B9%98\">⌨️ 8. EC2에 SSM Agent 설치</a></li>\n<li><a href=\"#%EF%B8%8F-9-pc%EC%97%90-ssm-plugin-%EC%84%A4%EC%B9%98%ED%9B%84-aws-cli%EB%A1%9C-ec2%EC%A0%91%EC%86%8D\">⌨️ 9. PC에 SSM plugin 설치후 aws cli로 EC2접속</a></li>\n<li><a href=\"#%EC%B0%B8%EA%B3%A0%EC%82%AC%EC%9D%B4%ED%8A%B8\">참고사이트</a></li>\n</ul>\n</li>\n</ul>\n</div>","excerpt":"👋 소개 awscli를 Roles Anywhere를 통해서 접속 해보자🙌 1 RootCA 인증서 만들기 (CA Bundle 인증서) - 1편 2 SSL 인증서 만들기 (RootCA로 서명한 aws접속용 인증서) - 1편 3 CA Bundle 등록(trust-anchor) - 2편 4 role 생성 - 2편 5 profile 생성 - 2편 6 aws_credential_helper로 credentials 생성 - 2편 7 aws cli 설치 및 명령어 사용 해보기 - 2편 8 EC2에 SSM Agent 설치 - 3편 9 PC에 SSM plugin 설치후 aws cli로 EC2접속 - 3편 ⌨️ 8. EC2에 SSM Agent 설치 https://docs.aws.amazon.com/ko_kr/systems-manager/latest/userguide/agent-install-al.html  EC2를 접속하여 아키텍처에 따른 Agent 설치  ⌨️ 9. PC에 SSM plugin 설치후 a…","frontmatter":{"date":"June 03, 2023","title":"[AWS] AWS CLI 사용하기 - SSM으로 EC2서버 접속(3)","categories":"AWS","author":"sb","emoji":"☁️"},"fields":{"slug":"/4-aws-3/"}},"next":{"id":"20307add-8563-58bc-b015-e35cd84456a2","html":"<h2 id=\"-소개\" style=\"position:relative;\"><a href=\"#-%EC%86%8C%EA%B0%9C\" aria-label=\" 소개 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>👋 소개</h2>\n<p>awscli를 Roles Anywhere를 통해서 접속 해보자🙌</p>\n<ul>\n<li>1 RootCA 인증서 만들기 (CA Bundle 인증서) - <strong>1편</strong></li>\n<li>2 SSL 인증서 만들기 (RootCA로 서명한 aws접속용 인증서) - <strong>1편</strong></li>\n<li>3 CA Bundle 등록(trust-anchor) - <strong>2편</strong></li>\n<li>4 role 생성 - <strong>2편</strong></li>\n<li>5 profile 생성 - <strong>2편</strong></li>\n<li>6 aws_credential_helper로 credentials 생성 - <strong>2편</strong></li>\n<li>7 aws cli 설치 및 명령어 사용 해보기 - <strong>2편</strong></li>\n<li>8 EC2에 SSM Agent 설치 - <strong>3편</strong></li>\n<li>9 PC에 SSM plugin 설치후 aws cli로 EC2접속 - <strong>3편</strong></li>\n</ul>\n<hr>\n<h3 id=\"️-3-ca-bundle-등록trust-anchor\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-3-ca-bundle-%EB%93%B1%EB%A1%9Dtrust-anchor\" aria-label=\"️ 3 ca bundle 등록trust anchor permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>⌨️ 3. CA Bundle 등록(trust-anchor)</h3>\n<p>AWS -> 서비스 검색 -> Roles Anywhere -> 트러스트 앵커 생성 <br></p>\n<blockquote>\n<p>앵커이름 : test <br>\nCertificate authority(CA) 소스 : 외부 인증서 번들 <br>\n외부 인증서 번들에는 1편에서 만든 lesstif-rootca.pem 파일 내용 복사 <br>\ntest 트러스트 앵커의 세부정보에 <code class=\"language-text\">트러스트 앵커 ARN</code> 내용 복사해두기 <br>\nex ) arn:aws:rolesanywhere:ap-northeast-2:testt123:trust-anchor/64438eff-ea71-449 <br></p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 95.55555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAACqElEQVQ4y5VUCZKjMAzk/x+b2t3cmdwnIZkQEobTxmCb3pJImOw966ouWTJuW1JjJ80yXIIAZ99HmqYoigJSyg+Q/wnQvlwIOFmew/cvOB5PEEKgrmsYYxjWGGitoauqsX9AdV8nYifPcxCpsRZlVUHKAoVSUKqEkJI/pkP+BlvXoKHKEg5d8+3tDM/zIPIciskUyrLklI3W+Oygw51cSARhDD8IkeQShhYsUJq6tUrbf8PUEIWCk2QCy2OAIJG4xALnKIcf5Yhk9Z/QiPICDtXpcg1xuYU4B1dcbu+QqoSpgcrYFsbWHKMMtK1/WCNQjMrkUAPiOOZOn89n+L6PMAyRZSmM0bC26fYxKbG/pnAv7/ATibisESn7gbJGKhUcedddnCRI0pSlQ11/dLiqNCrdpBVmEmEqEAuFvDTIlG5BviDZkJj3rovNZovDwYO1ttUWpfCArkpoXTXgg8pGn/e5YR3K5oYkYroZaZL+nKJQsLVlfT1rjQ4jS5qt7ocytGYNCkGEUsJ1D1gsV5jNF5jPF1guV3APBxxPJ+z3Lq/Tn3Q6veHgeQiCK2dBo76LmsiobA5NJtMZ+oMhev0BBmR7fXQ6PY51u310uj1863TR7fYwGo35OyrDMyFdLCFCmlD9xuNXJh4OR0xK8+l0htlsziRETpb818mUU/0tIb0S1AxKd7Vac7q73R7b7Y7LsFpvsNnuOEbprtcbnv+asmhSpqZ4xyOWqzVvpA3uwWtJt/fYbr/HZrttyX++IflZljWEJBu62WKxxHQ2Z/LnJk0mU14nkE/x5xo+QNplQiJ6efmCXm+Afn+A8XjClppDtf36rcPNGQxHGI7GGL9O2pQfoyWk5yuKY9zCkHG93RC+RxwjS3VhP4oRxwlbWnu80o1V/I7mucB31lymdQGbh8AAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"사진1\"\n        title=\"사진1\"\n        src=\"/static/83d01e369e8c149896c2b3cb3566befd/37523/1.png\"\n        srcset=\"/static/83d01e369e8c149896c2b3cb3566befd/e9ff0/1.png 180w,\n/static/83d01e369e8c149896c2b3cb3566befd/f21e7/1.png 360w,\n/static/83d01e369e8c149896c2b3cb3566befd/37523/1.png 720w,\n/static/83d01e369e8c149896c2b3cb3566befd/5d72a/1.png 834w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<hr>\n<h3 id=\"️-4-role-생성\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-4-role-%EC%83%9D%EC%84%B1\" aria-label=\"️ 4 role 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>⌨️ 4. role 생성</h3>\n<p>AWS -> 서비스 검색 -> Roles Anywhere -> 설정 단계 -> 역할 구성 -> 새 역할 생성  <br></p>\n<blockquote>\n<p>신뢰할수 있는 엔티티 유형 : AWS 서비스 <br>\n다른 AWS 서비스의 사용사례 : Roles Anywhere -> 다음<br>\n신뢰 할수 있는 엔티티 선택  내용에 아래와 같이 Condition 추가  <br>\n“aws:SourceArn” 은 위에 트러스트 앵커의 arn 복붙 <br></p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"Version\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"2012-10-17\"</span>,\n    <span class=\"token string\">\"Statement\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"Effect\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"Allow\"</span>,\n            <span class=\"token string\">\"Principal\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token string\">\"Service\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"rolesanywhere.amazonaws.com\"</span>\n            <span class=\"token punctuation\">}</span>,\n            <span class=\"token string\">\"Action\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token string\">\"sts:AssumeRole\"</span>,\n                <span class=\"token string\">\"sts:SetSourceIdentity\"</span>,\n                <span class=\"token string\">\"sts:TagSession\"</span>\n            <span class=\"token punctuation\">]</span>,\n            <span class=\"token string\">\"Condition\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token string\">\"ArnEquals\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token string\">\"aws:SourceArn\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"arn:aws:rolesanywhere:ap-northeast-2:testtestte:trust-anchor/test-ea71-test-test-test\"</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>생성 이후 <code class=\"language-text\">롤의 ARN</code> 복붙 <br></p>\n</blockquote>\n<hr>\n<h3 id=\"️-5-profile-생성\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-5-profile-%EC%83%9D%EC%84%B1\" aria-label=\"️ 5 profile 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>⌨️ 5. profile 생성</h3>\n<p>AWS -> 서비스 검색 -> Roles Anywhere -> 프로파일 생성 <br></p>\n<blockquote>\n<p>프로파일 이름 : test <br>\n역할은 4번에서 만든 test 로 선택 <br>\n나머지는 수정없이 프로파일 생성 <br>\n생성 이후 <code class=\"language-text\">프로파일의 ARN</code> 복붙 <br></p>\n</blockquote>\n<hr>\n<h3 id=\"️-6-aws_credential_helper로-credentials-생성\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-6-aws_credential_helper%EB%A1%9C-credentials-%EC%83%9D%EC%84%B1\" aria-label=\"️ 6 aws_credential_helper로 credentials 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>⌨️ 6. aws_credential_helper로 credentials 생성</h3>\n<blockquote>\n<p><a href=\"https://docs.aws.amazon.com/rolesanywhere/latest/userguide/credential-helper.html\">https://docs.aws.amazon.com/rolesanywhere/latest/userguide/credential-helper.html</a>\n본인이 사용하는 OS 별로 다운로드\n아래와 내용 복사해서 쳐보기 (* 인증서와 키 경로는 full path를 쳐야함)</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 2,3번 라인은 2편 RootCA로 서명한 aws접속용 crt,key파일 경로</span>\n<span class=\"token comment\"># 4,5,6번 라인은 위에서 만든 ARN 3개 trust-anchor,profile,role를 넣기  </span>\n\n./aws_signing_helper credential-process <span class=\"token punctuation\">\\</span>\n      <span class=\"token parameter variable\">--certificate</span> /path/to/certificate <span class=\"token punctuation\">\\</span> \n      --private-key /path/to/private-key <span class=\"token punctuation\">\\</span> \n      --trust-anchor-arn arn:aws:rolesanywhere:region:account:trust-anchor/TA_ID <span class=\"token punctuation\">\\</span>\n      --profile-arn arn:aws:rolesanywhere:region:account:profile/PROFILE_ID <span class=\"token punctuation\">\\</span>\n      --role-arn arn:aws:iam::account:role/role-name-with-path\n\n<span class=\"token comment\"># 입력해서 성공하면 아래처럼 나옴 </span>\n<span class=\"token punctuation\">{</span><span class=\"token string\">\"Version\"</span>:1,<span class=\"token string\">\"AccessKeyId\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"ASIAXNQ~~~~~CYZL\"</span>,<span class=\"token string\">\"SecretAccessKey\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"N7LWW~~~~~~~igU6PR67dFylHSHoAt\"</span>,\n<span class=\"token string\">\"SessionToken\"</span>:\"IQoJb3JpZ2luX2VjEIf//////////wEaDmFwLW5vcnRoZWFzdC0yIkgwRgIhAOwy+O9Tz+x7FfztORGHC03BLE4E\n+vclwgP830gUmQt6AiEAtIq+vgzKNQhlC2o9bXsyWZuKqzbJoEXr4oKYP9qMrq8qvwMIwf//////////\nARADGgw1MTAwODczNjU2OTAiDI4vmdEDEQ/nThQwWSqTAxkMG2/\n4bhgxXPy73aQxj49fujBbx5FLZmp57Ufl461J0UCGgAIKo1m7nyKm8YQZ6vIcz3uG1BJFSKg78IABKkjzUbSkr2bM/zap\n+Ykk66R9SnoPao75j0t1fkShwoqqy8JAg20r7ikLRt3yLXXLLVP6UY~<span class=\"token punctuation\">}</span></code></pre></div>\n<hr>\n<h3 id=\"️-7-aws-cli-설치-및-명령어-사용-해보기\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-7-aws-cli-%EC%84%A4%EC%B9%98-%EB%B0%8F-%EB%AA%85%EB%A0%B9%EC%96%B4-%EC%82%AC%EC%9A%A9-%ED%95%B4%EB%B3%B4%EA%B8%B0\" aria-label=\"️ 7 aws cli 설치 및 명령어 사용 해보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>⌨️ 7. aws cli 설치 및 명령어 사용 해보기</h3>\n<blockquote>\n<p><a href=\"https://docs.aws.amazon.com/ko_kr/cli/latest/userguide/getting-started-install.html\">https://docs.aws.amazon.com/ko_kr/cli/latest/userguide/getting-started-install.html</a>\n본인에게 해당되는 OS로 설치\nMacOS는 terminal 에서 aws 명령어 쳐러 아래처럼 나오면 성공</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">usage: aws <span class=\"token punctuation\">[</span>options<span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;</span>command<span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>subcommand<span class=\"token operator\">></span> <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span>subcommand<span class=\"token operator\">></span> <span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>parameters<span class=\"token punctuation\">]</span>\nTo see <span class=\"token builtin class-name\">help</span> text, you can run:\n\n  aws <span class=\"token builtin class-name\">help</span>\n  aws <span class=\"token operator\">&lt;</span>command<span class=\"token operator\">></span> <span class=\"token builtin class-name\">help</span>\n  aws <span class=\"token operator\">&lt;</span>command<span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>subcommand<span class=\"token operator\">></span> <span class=\"token builtin class-name\">help</span>\n\naws: error: the following arguments are required: <span class=\"token builtin class-name\">command</span></code></pre></div>\n<hr>\n<h3 id=\"️-8-aws-cli로-ec2-정보-가져와보기\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-8-aws-cli%EB%A1%9C-ec2-%EC%A0%95%EB%B3%B4-%EA%B0%80%EC%A0%B8%EC%99%80%EB%B3%B4%EA%B8%B0\" aria-label=\"️ 8 aws cli로 ec2 정보 가져와보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>⌨️ 8. aws cli로 ec2 정보 가져와보기</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">aws ec2 describe-instances</code></pre></div>\n<hr>\n<h3 id=\"참고사이트\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0%EC%82%AC%EC%9D%B4%ED%8A%B8\" aria-label=\"참고사이트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고사이트</h3>\n<blockquote>\n<p>hhttps://docs.aws.amazon.com/rolesanywhere/latest/userguide/credential-helper.html<br>\n<a href=\"https://docs.aws.amazon.com/ko_kr/cli/latest/userguide/getting-started-install.html\">https://docs.aws.amazon.com/ko_kr/cli/latest/userguide/getting-started-install.html</a></p>\n</blockquote>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#-%EC%86%8C%EA%B0%9C\">👋 소개</a></p>\n<ul>\n<li><a href=\"#%EF%B8%8F-3-ca-bundle-%EB%93%B1%EB%A1%9Dtrust-anchor\">⌨️ 3. CA Bundle 등록(trust-anchor)</a></li>\n<li><a href=\"#%EF%B8%8F-4-role-%EC%83%9D%EC%84%B1\">⌨️ 4. role 생성</a></li>\n<li><a href=\"#%EF%B8%8F-5-profile-%EC%83%9D%EC%84%B1\">⌨️ 5. profile 생성</a></li>\n<li><a href=\"#%EF%B8%8F-6-aws_credential_helper%EB%A1%9C-credentials-%EC%83%9D%EC%84%B1\">⌨️ 6. aws_credential_helper로 credentials 생성</a></li>\n<li><a href=\"#%EF%B8%8F-7-aws-cli-%EC%84%A4%EC%B9%98-%EB%B0%8F-%EB%AA%85%EB%A0%B9%EC%96%B4-%EC%82%AC%EC%9A%A9-%ED%95%B4%EB%B3%B4%EA%B8%B0\">⌨️ 7. aws cli 설치 및 명령어 사용 해보기</a></li>\n<li><a href=\"#%EF%B8%8F-8-aws-cli%EB%A1%9C-ec2-%EC%A0%95%EB%B3%B4-%EA%B0%80%EC%A0%B8%EC%99%80%EB%B3%B4%EA%B8%B0\">⌨️ 8. aws cli로 ec2 정보 가져와보기</a></li>\n<li><a href=\"#%EC%B0%B8%EA%B3%A0%EC%82%AC%EC%9D%B4%ED%8A%B8\">참고사이트</a></li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"June 02, 2023","title":"[AWS] AWS CLI 사용하기 - Roles Anywhere 설정(2)","categories":"AWS","author":"sb","emoji":"☁️"},"fields":{"slug":"/4-aws-2/"}},"prev":{"id":"14ecab48-f067-5833-832e-13cde7c7664b","html":"<h2 id=\"-소개\" style=\"position:relative;\"><a href=\"#-%EC%86%8C%EA%B0%9C\" aria-label=\" 소개 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>👋 소개</h2>\n<p>SSH 접근을 중앙에서 관리해 보자🙌</p>\n<ul>\n<li>1 pam 설정</li>\n<li>2 (client)api 요청 쉘파일 설정</li>\n<li>3 (server)api 응답 서버 코드</li>\n<li>4 ssh 중앙관리 플로우</li>\n</ul>\n<hr>\n<h3 id=\"️-1-pam-설정\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-1-pam-%EC%84%A4%EC%A0%95\" aria-label=\"️ 1 pam 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>⌨️ 1. pam 설정</h3>\n<blockquote>\n<p>pam(Pluggable Authentication Module)은 사용 권한을 제어하는 모듈이다<br></p>\n<ul>\n<li>1번째 인자 <code class=\"language-text\">session</code>은 sshd 세션을 열었을때 옵션이다 <br></li>\n<li>2번째 인자 <code class=\"language-text\">required</code> - 해당 설정으로 진행 시 실패하면 인증을 거부한다 <br></li>\n<li>2번째 인자 <code class=\"language-text\">optional</code> - 해당 설정으로 진행 시 실패해도 인증은 성공한다 <br></li>\n<li>3번째 인자 <code class=\"language-text\">pam_exec.so</code> 는 내가 지정한 파일을 실행시키는 옵션이다 <br></li>\n<li>4번째 인자 <code class=\"language-text\">/etc/ssh.sh</code> 는 내가 지정한 파일의 경로이다 <br></li>\n</ul>\n<p>/etc/pam.d/sshd 설정 <br></p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">vi</span> /etc/pam.d/sshd\n<span class=\"token comment\"># 맨마지막 줄에 아래 옵션을 추가한다 (잘못설정하면 영영 ssh접근이안되니.. 테스트는 optional로)</span>\nsession optional pam_exec.so /etc/ssh.sh\n</code></pre></div>\n<hr>\n<h3 id=\"️-2-etcsshsh-api-설정\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-2-etcsshsh-api-%EC%84%A4%EC%A0%95\" aria-label=\"️ 2 etcsshsh api 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>⌨️ 2. /etc/ssh.sh api 설정</h3>\n<blockquote>\n<p>exit code <code class=\"language-text\">0</code>은 정상 종료, exit code <code class=\"language-text\">1</code>은 에러 비정상종료 <br></p>\n<ul>\n<li><code class=\"language-text\">$PAM_RHOST</code>는 접근시도한 Remote 호스트<br></li>\n<li><code class=\"language-text\">$PAM_USER</code>는 접근하려는 User 값을 받아올수있다 <br></li>\n</ul>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># api로 로그인 성공 api 호출</span>\n<span class=\"token function\">vi</span> /etc/ssh.sh\n\n\n<span class=\"token comment\">#!/bin/bash</span>\n<span class=\"token assign-left variable\">STATUS</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-o</span> /dev/null <span class=\"token parameter variable\">-w</span> <span class=\"token string\">\"%{http_code}\"</span> <span class=\"token string\">\"http://localhost:8089/api1/<span class=\"token variable\">$PAM_RHOST</span>/<span class=\"token variable\">$PAM_USER</span>\"</span><span class=\"token variable\">)</span></span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">$STATUS</span> <span class=\"token parameter variable\">-eq</span> <span class=\"token number\">200</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"로그인 성공\"</span>\n  <span class=\"token builtin class-name\">exit</span> <span class=\"token number\">0</span>\n<span class=\"token keyword\">else</span>\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"로그인 실패\"</span>\n  <span class=\"token builtin class-name\">exit</span> <span class=\"token number\">1</span>\n<span class=\"token keyword\">fi</span></code></pre></div>\n<hr>\n<h3 id=\"️-3-api-서버-코드\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-3-api-%EC%84%9C%EB%B2%84-%EC%BD%94%EB%93%9C\" aria-label=\"️ 3 api 서버 코드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>⌨️ 3. api 서버 코드</h3>\n<blockquote>\n<p><strong>api 1</strong>은 response code <code class=\"language-text\">200</code>, <strong>api 2</strong>는 response code <code class=\"language-text\">400</code>을 준다<br></p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> main\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n\t<span class=\"token string\">\"log\"</span>\n\t<span class=\"token string\">\"net/http\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\thttp<span class=\"token punctuation\">.</span><span class=\"token function\">HandleFunc</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api1\"</span><span class=\"token punctuation\">,</span> index1<span class=\"token punctuation\">)</span>\n\thttp<span class=\"token punctuation\">.</span><span class=\"token function\">HandleFunc</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api2\"</span><span class=\"token punctuation\">,</span> index2<span class=\"token punctuation\">)</span>\n\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Fatal</span><span class=\"token punctuation\">(</span>http<span class=\"token punctuation\">.</span><span class=\"token function\">ListenAndServe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\":8089\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">index1</span><span class=\"token punctuation\">(</span>w http<span class=\"token punctuation\">.</span>ResponseWriter<span class=\"token punctuation\">,</span> r <span class=\"token operator\">*</span>http<span class=\"token punctuation\">.</span>Request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    sourceip <span class=\"token operator\">:=</span> strings<span class=\"token punctuation\">.</span><span class=\"token function\">Split</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">.</span>RemoteAddr<span class=\"token punctuation\">,</span> <span class=\"token string\">\":\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n    fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Source IP \"</span><span class=\"token punctuation\">,</span>sourceip<span class=\"token punctuation\">)</span>\n    fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Destination IP \"</span><span class=\"token punctuation\">,</span>r<span class=\"token punctuation\">.</span>URL<span class=\"token punctuation\">.</span>Path<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"사용자\"</span><span class=\"token punctuation\">,</span>r<span class=\"token punctuation\">.</span>URL<span class=\"token punctuation\">.</span>Path<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\tw<span class=\"token punctuation\">.</span><span class=\"token function\">WriteHeader</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n\tw<span class=\"token punctuation\">.</span><span class=\"token function\">Write</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token function\">byte</span><span class=\"token punctuation\">(</span>http<span class=\"token punctuation\">.</span><span class=\"token function\">StatusText</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">index2</span><span class=\"token punctuation\">(</span>w http<span class=\"token punctuation\">.</span>ResponseWriter<span class=\"token punctuation\">,</span> r <span class=\"token operator\">*</span>http<span class=\"token punctuation\">.</span>Request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    sourceip <span class=\"token operator\">:=</span> strings<span class=\"token punctuation\">.</span><span class=\"token function\">Split</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">.</span>RemoteAddr<span class=\"token punctuation\">,</span> <span class=\"token string\">\":\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n    fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Source IP \"</span><span class=\"token punctuation\">,</span>sourceip<span class=\"token punctuation\">)</span>\n    fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Destination IP \"</span><span class=\"token punctuation\">,</span>r<span class=\"token punctuation\">.</span>URL<span class=\"token punctuation\">.</span>Path<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"사용자\"</span><span class=\"token punctuation\">,</span>r<span class=\"token punctuation\">.</span>URL<span class=\"token punctuation\">.</span>Path<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\tw<span class=\"token punctuation\">.</span><span class=\"token function\">WriteHeader</span><span class=\"token punctuation\">(</span><span class=\"token number\">400</span><span class=\"token punctuation\">)</span>\n\tw<span class=\"token punctuation\">.</span><span class=\"token function\">Write</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token function\">byte</span><span class=\"token punctuation\">(</span>http<span class=\"token punctuation\">.</span><span class=\"token function\">StatusText</span><span class=\"token punctuation\">(</span><span class=\"token number\">400</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<hr>\n<h3 id=\"️-4-ssh-중앙관리-플로우\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-4-ssh-%EC%A4%91%EC%95%99%EA%B4%80%EB%A6%AC-%ED%94%8C%EB%A1%9C%EC%9A%B0\" aria-label=\"️ 4 ssh 중앙관리 플로우 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>⌨️ 4. ssh 중앙관리 플로우</h3>\n<blockquote>\n<p>사용자는 미리 ssh 중앙관리 서버에 source,dest IP를 api서버에 정책으로 넣어두고 <br>\nsource와 dest IP가 DB에 있으면 <code class=\"language-text\">200</code>을 리턴해서 접근성공 <br>\nsource와 dest IP가 DB에 없으면 <code class=\"language-text\">400</code>을 리턴해서 접근실패<br>\n아래 플로우로 SSH 중앙관리를 할 수 있다<br></p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 76.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACDElEQVQ4y52Tz2/TMBzF+39z44bggoQ4gISYNMEBiU1cKBpsjF8bpbSrCk27rfRX0jS0zU8ndpw4D9ldIGvTHbBkOXacT977+rmCkpZlmRo9z0Mcx2VbQCmF63rX9stW2QZjLEat8RO1elMughACx3HUD9I0gXY+xNHHU7Ve/G4rkIQMj3Ze4t79B2ruui4sy0JEKTiPUT2s4dbtOzBnM/VeCLECSkDei0AhMjRaHTRb7VLLo4mJg8NjsKuSlCpch+ZNwvM1WTtCQpAgQByzDXcVzhNMzd/K0jpU2sitIBNIEw5GI5DAh2PbsG0bvu+rw4uiaKVwMDLwfO8Nvp51wDn/C8tFpiKDTwWWPsPIWCBgGUgMxDxRIiRMjmEYroCX/QEeP9tH9WyIkfGvwLlSO0ihGQm6BoemM3SnCbqmgD6PQKNw0/LqRCNcjqcII6qiYRhTzCwLmUix8FP0TIFmz0L17QccnbSh6Ry/DA8hCQqOioeSZUh4rDImi84YU6MsujEn+DGmeH/aw92HO3jyugZtwtDXHXDONoNdjE3xRf648BP0zBQ9neLVlwvs10Zo9BbQF7Q0EZWi5DJ4DuxMInxqDPFds1A/t68Bb7x665mcewkuLOCkNcbT3T28+9zGYAnMnGS7wpuAy0AqzPCtO8fuiwMc1/tqPnP4/wFlDh2Swg3FVV/Nk7T8Vv0BrheCaqxkHgIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"사진1\"\n        title=\"사진1\"\n        src=\"/static/acdd72eead2f01abc53ab46504fdc3aa/37523/1.png\"\n        srcset=\"/static/acdd72eead2f01abc53ab46504fdc3aa/e9ff0/1.png 180w,\n/static/acdd72eead2f01abc53ab46504fdc3aa/f21e7/1.png 360w,\n/static/acdd72eead2f01abc53ab46504fdc3aa/37523/1.png 720w,\n/static/acdd72eead2f01abc53ab46504fdc3aa/302a4/1.png 1080w,\n/static/acdd72eead2f01abc53ab46504fdc3aa/bb543/1.png 1418w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"참고사이트\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0%EC%82%AC%EC%9D%B4%ED%8A%B8\" aria-label=\"참고사이트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고사이트</h3>\n<blockquote>\n<p><a href=\"https://wariua.github.io/linux-pam-docs-ko/sag-pam_exec.html\">https://wariua.github.io/linux-pam-docs-ko/sag-pam_exec.html</a></p>\n</blockquote>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#-%EC%86%8C%EA%B0%9C\">👋 소개</a></p>\n<ul>\n<li><a href=\"#%EF%B8%8F-1-pam-%EC%84%A4%EC%A0%95\">⌨️ 1. pam 설정</a></li>\n<li><a href=\"#%EF%B8%8F-2-etcsshsh-api-%EC%84%A4%EC%A0%95\">⌨️ 2. /etc/ssh.sh api 설정</a></li>\n<li><a href=\"#%EF%B8%8F-3-api-%EC%84%9C%EB%B2%84-%EC%BD%94%EB%93%9C\">⌨️ 3. api 서버 코드</a></li>\n<li><a href=\"#%EF%B8%8F-4-ssh-%EC%A4%91%EC%95%99%EA%B4%80%EB%A6%AC-%ED%94%8C%EB%A1%9C%EC%9A%B0\">⌨️ 4. ssh 중앙관리 플로우</a></li>\n<li><a href=\"#%EC%B0%B8%EA%B3%A0%EC%82%AC%EC%9D%B4%ED%8A%B8\">참고사이트</a></li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"June 04, 2023","title":"[보안] SSH 접근 중앙관리 - pam 설정(1)","categories":"보안","author":"sb","emoji":"🔐"},"fields":{"slug":"/5-security-ssh-1/"}},"site":{"siteMetadata":{"siteUrl":"https://sbbs.me","comments":{"utterances":{"repo":""}}}}},"pageContext":{"slug":"/4-aws-3/","nextSlug":"/4-aws-2/","prevSlug":"/5-security-ssh-1/"}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}